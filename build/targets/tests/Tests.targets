<Project>
  <PropertyGroup Condition=" '$(IsTestProject)' == 'true' ">
    <!-- Enable test logging to TRX files and place them in the artifacts directory -->
    <VSTestLogger>trx%3bLogFileName=$(MSBuildProjectName).trx</VSTestLogger>
    <VSTestResultsDirectory Condition="'$(VSTestResultsDirectory)' == ''">$(ArtifactsTestResultsPath)/$(TargetFramework)</VSTestResultsDirectory>
    <_TestCodeCoverageMergedReport>$(ArtifactsTestResultsPath)/report.cobertura.xml</_TestCodeCoverageMergedReport>
  </PropertyGroup>

  <Target Name="GenerageCodeCoverageReport" AfterTargets="Test;VSTest" Condition=" '$(IsTestProject)' == 'true' ">
    <ItemGroup>
      <_CoverageFiles Include="$(ArtifactsTestResultsPath)/**/*.cobertura.xml" />
    </ItemGroup>
    <ReportGenerator ProjectDirectory="$(MSBuildProjectDirectory)" ReportFiles="@(_CoverageFiles)" TargetDirectory="$(ArtifactsTestResultsPath)/coverage" ReportTypes="MarkdownSummaryGithub;Cobertura;HtmlInline" />
    <Delete Files="@(_CoverageFiles)" /><!-- Prevent this run's coverage files from being merged into the next run. -->
  </Target>
</Project>
